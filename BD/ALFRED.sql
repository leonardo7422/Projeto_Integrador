
DROP database if exists ALFRED;

CREATE DATABASE if not exists ALFRED;

 USE ALFRED;
 
 CREATE TABLE IF NOT EXISTS CLASSIFICACAO (
    ID_CLASSIFICACAO INT NOT NULL PRIMARY KEY,
    CLASSIFICACAO_INDICATIVA VARCHAR(10)
);
 CREATE TABLE IF NOT EXISTS ATOR (
    ID_ATOR INT NOT NULL PRIMARY KEY,
    NOME_ATOR VARCHAR(50)
);

CREATE TABLE IF NOT EXISTS DIRETOR (
    ID_DIRETOR INT NOT NULL PRIMARY KEY,
    NOME_DIRETOR VARCHAR(50)
);

 CREATE TABLE IF NOT EXISTS FILME (
    ID_FILME INT NOT NULL PRIMARY KEY,
    ID_ATOR INT NOT NULL,
    ID_DIRETOR INT NOT NULL,
    ID_CLASSIFICACAO INT NOT NULL,
	TITULO VARCHAR(50),
    SINOPSE VARCHAR(300),
    FICHA_TECNICA VARCHAR(100),
    DATA_ESTREIA DATE,
    DATA_RETIRADA DATE,
    FOREIGN KEY (ID_ATOR)
        REFERENCES ATOR (ID_ATOR)
        ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (ID_DIRETOR)
        REFERENCES DIRETOR (ID_DIRETOR)
        ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY (ID_CLASSIFICACAO)
        REFERENCES CLASSIFICACAO(ID_CLASSIFICACAO)
        ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS USUARIO (
	ID_USUARIO INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
    CEP VARCHAR(9),
    ACESSO ENUM('USUARIO','ADM'),
    EMAIL VARCHAR(50),
    NOME VARCHAR(50),
    LOGIN VARCHAR(50),
    SENHA VARCHAR(50)
    
);


CREATE TABLE IF NOT EXISTS LISTA_DESEJO (
	ID_USUARIO INT  UNSIGNED NOT NULL  AUTO_INCREMENT,
    ID_FILME INT NOT NULL,
    PRIMARY KEY(ID_USUARIO, ID_FILME),
    FOREIGN KEY (ID_USUARIO)
        REFERENCES USUARIO (ID_USUARIO)
        ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (ID_FILME)
        REFERENCES FILME (ID_FILME)
        ON UPDATE CASCADE ON DELETE CASCADE
);




CREATE TABLE IF NOT EXISTS GENERO (
    ID_GENERO INT NOT NULL PRIMARY KEY,
    DESCRICAO_GENERO VARCHAR(50)
);


CREATE TABLE IF NOT EXISTS GENERO_FILME (
    ID_FILME INT NOT NULL,
    ID_GENERO INT NOT NULL,
    PRIMARY KEY (ID_FILME , ID_GENERO),
    FOREIGN KEY (ID_FILME)
        REFERENCES FILME (ID_FILME)
        ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (ID_GENERO)
        REFERENCES GENERO (ID_GENERO)
        ON UPDATE CASCADE ON DELETE CASCADE
);




CREATE TABLE IF NOT EXISTS HISTORICO (
    ID_USUARIO INT  UNSIGNED NOT NULL  AUTO_INCREMENT,
    ID_FILME INT NOT NULL,
    PRIMARY KEY(ID_USUARIO, ID_FILME),
    FOREIGN KEY (ID_USUARIO)
        REFERENCES USUARIO (ID_USUARIO)
        ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (ID_FILME)
        REFERENCES FILME (ID_FILME)
        ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS AVALIACAO_FILME (
    ID_USUARIO INT NOT NULL,
    COMENTARIO VARCHAR(50),
    ID_FILME INT NOT NULL,
    NOTA INT,
    DATA DATE,
      FOREIGN KEY (ID_FILME)
        REFERENCES HISTORICO (ID_FILME)
        ON UPDATE CASCADE ON DELETE CASCADE
);


CREATE TABLE IF NOT EXISTS CIDADE (
    ID_CIDADE INT NOT NULL PRIMARY KEY,
    NOME_CIDADE VARCHAR(50)
);


CREATE TABLE IF NOT EXISTS CINEMA (
    ID_CINEMA INT NOT NULL PRIMARY KEY,
    NOME_CINEMA VARCHAR(50),
    ID_CIDADE INT NOT NULL,
    FOREIGN KEY (ID_CIDADE)
        REFERENCES CIDADE (ID_CIDADE)
        ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS SESSAO (
    ID_SESSAO INT NOT NULL PRIMARY KEY,
    SITE_COMPRA VARCHAR(100),
    HORARIO TIME,
    ID_CINEMA INT NOT NULL,
    ID_FILME INT ,
    FOREIGN KEY (ID_CINEMA)
        REFERENCES CINEMA (ID_CINEMA)
        ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY (ID_FILME)
        REFERENCES FILME(ID_FILME)
        ON UPDATE CASCADE ON DELETE CASCADE
);

SELECT *
FROM USUARIO;


    SELECT NOME FROM USUARIO WHERE login = 123;

	SELECT ID_ATOR AS value, NOME_ATOR AS texto FROM ATOR ORDER BY NOME_ATOR;
    

    
    insert into classificacao values (1, '18');
    
	insert into ator values (1, "Joaquin Phoenix");
    	insert into ator values (2, "TESTE TESTE");
    
    insert into diretor values (1, "Todd Phillips");
    	insert into diretor values (2, "TESTE TESTE");
    
    insert into genero values (1, "Comédia");
    	insert into genero values (2, "TESTE TESTE");
    
    insert into filme values (1, 1, 1, 1, 'Coringa', 'aaaaaaaaaaaaaaaaaa', 'Duração: 190 min', '2019-10-10', '2019-11-10');
        insert into filme values (2, 2, 2, 1, 'Resident Evil', 'aaaaaaaaaaaaaaaaaa', 'Duração: 190 min', '2019-10-10', '2019-11-10');
    
    insert into genero_filme values (1, 1);
      	insert into genero_filme values (2, 2);
    
    SELECT * 
	FROM filme, genero_filme, genero, diretor, ator
	WHERE filme.id_filme = genero_filme.id_filme
	AND genero_filme.id_genero = genero.id_genero
	AND filme.id_diretor = diretor.id_diretor
	AND filme.id_ator = ator.id_ator
	AND titulo like'Coringa%';
    
    SELECT CLASSIFICACAO_INDICATIVA, TITULO
	FROM CLASSIFICACAO, FILME
	WHERE FILME.ID_CLASSIFICACAO = CLASSIFICACAO.ID_CLASSIFICACAO
	AND TITULO LIKE 'Coringa%';
    
select *
from usuario;
    
SELECT id_usuario
from usuario
where login = 'leo';

SELECT *
from filme;

select *
from lista_desejo;

SELECT *
from usuario
;

INSERT INTO lista_desejo VALUES ('1', '1');

select *
from lista_desejo;

DELETE FROM lista_desejo
WHERE ID_filme = 2;

SELECT * 
	FROM filme,ator,diretor,genero_filme
    where ator.id_ator = filme.id_ator
    and filme.id_filme = genero_filme.id_filme
    and diretor.id_diretor = filme.id_diretor;
    
    SELECT *
from usuario;

insert into usuario values( 2, 00000000, 'ADM', 'admin@123.com', 'Admin', 'admin', '202cb962ac59075b964b07152d234b70');